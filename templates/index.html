<html>
<head>
	<title>Local Net Monit</title>

	<style>
		/* charcoal dark background */
		body {
			background-color: #333;
			color: #ddd;
			font-family: Arial, sans-serif;
		}

		/* Horizontal line at 33% from the top */
		.horizontal-line {
			position: absolute;
			top: 33%;
			width: 100%;
			border-top: 2px solid black;
		}

		.title-top {
			text-align: center;
			font-size: 24px;
			margin-top: 20px;
		}

		.title-local-network {
			position: absolute;
			top: calc(33% + 10px); /* Positioning below the line */
			left: 50%;
			transform: translateX(-50%);
			font-size: 24px;
		}

		.port-boxes {
		    position: absolute;
		    top: calc(33% - 80px); /* Adjust the vertical position above the line */
		    left: 50%;
		    transform: translateX(-50%);
		    display: flex;
		    gap: 20px; /* Space between boxes */
		}

		/* Styling for Ethernet-like port box */
		.port-box {
		    width: 70px;
		    height: 60px;
		    background-color: #222;
		    border: 3px solid #888; /* Simulating a metallic border */
		    border-radius: 3px;
		    position: relative;
		    display: flex;
		    justify-content: center;
		    align-items: center;
		    color: white;
		    font-size: 15px;
		    text-align: center;
		    cursor: pointer; /* Make it clickable */
		}

		/* Simulating port "keyhole" slots at the bottom */
		.port-box::before {
		    content: '';
		    position: absolute;
		    bottom: 5px;
		    left: 50%;
		    transform: translateX(-50%);
		    width: 20px;
		    height: 5px;
		    background-color: green; /* Darker area representing the socket holes */
		    border-radius: 2px;
		}

		.port-box-warning::before {
		    content: '';
		    position: absolute;
		    bottom: 5px;
		    left: 50%;
		    transform: translateX(-50%);
		    width: 20px;
		    height: 5px;
		    background-color: red; /* Darker area representing the socket holes */
		    border-radius: 2px;
		}

		/* Simulating the plastic shield on top */
		.port-box::after {
		    content: '';
		    position: absolute;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 50%;
		    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), transparent);
		    border-top-left-radius: 2px;
		    border-top-right-radius: 2px;
		}

		/* Styling for the IP table */
		.ip-table-container {
			position: absolute;
			top: calc(33% + 60px); /* Adjust vertical position below the line */
			width: 100%;
			display: flex;
			justify-content: center;
		}

		.ip-table {
			width: 80%;
			border-collapse: collapse;
			background-color: #444;
			border: 1px solid #555;
		}

		.ip-table th, .ip-table td {
			padding: 12px;
			border: 1px solid #555;
			text-align: center;
		}

		.ip-table th {
			background-color: #555;
			color: #ddd;
		}

		.ip-table td {
			background-color: #333;
			color: #fff;
		}

		/* Max width limit for ports column */
		.ip-table .ports-column {
			max-width: 300px;
			overflow-wrap: break-word; /* Ensure ports wrap if the content exceeds max width */
		}

		.port-container {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
			justify-content: center;
			max-width: 100%; /* Ensure ports don't overflow the column */
		}

		/* Popup modal */
		.modal {
			display: none; /* Hidden by default */
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.7); /* Black background with opacity */
		}

		.modal-content {
			background-color: #444;
			margin: 15% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 500px; 
			color: #fff;
			text-align: center;
			border-radius: 8px; /* Rounded corners */
		}

		.close {
			color: #aaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: #fff;
			text-decoration: none;
			cursor: pointer;
		}

		/* Styling for form elements */
		form {
			display: flex;
			flex-direction: column;
			align-items: flex-start; /* Align labels and inputs vertically */
			gap: 20px;
			margin-top: 20px;
		}

		label {
			font-size: 18px;
			margin-bottom: 5px;
		}

		/* Align the checkbox with its label */
		.modal-checkbox-container {
			display: flex;
			align-items: center;
		}

		.modal-port-notes-container {
			text-align: left;
		}

		input[type="checkbox"] {
			transform: scale(1.5);
			margin-left: 10px;
		}

		textarea {
			width: 100%;
			padding: 10px;
			font-size: 16px;
			border-radius: 4px;
			border: 1px solid #888;
			background-color: #333;
			color: #fff;
			resize: vertical; /* Allow vertical resizing */
		}

		button {
			padding: 10px 20px;
			font-size: 18px;
			border: none;
			border-radius: 4px;
			background-color: #5cb85c;
			color: #fff;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		button:hover {
			background-color: #4cae4c;
		}
	</style>
</head>
<body>
	<div class="title-top">Internet ({{ .NetScanner.PublicNode.IP }})</div>
	<div class="title-local-network">Local Network</div>
	
	<div class="port-boxes">
		{{range $port := .NetScanner.PublicNode.Ports }}
			<div class="port-box" onclick="openModal({ ip: '{{ .NetScanner.PublicNode.IP }}', portNumber: {{ $port.PortNumber }}, verified: {{ $port.Verified }}, notes: '{{ $port.Notes }}'})">
				Port {{ $port.PortNumber }}
			</div>
		{{end}}
			<div class="port-box" onclick="openModal({ ip: '10.0.0.1', portNumber: 1234, verified: false, notes: 'hello!' })">
				Port 10100
			</div>
	</div>

	<div class="horizontal-line"></div>

	<!-- IP table below the horizontal line -->

	<div class="ip-table-container">
		<table class="ip-table">
			<thead>
				<tr>
					<th>IP Address</th>
					<th>Latency (ms)</th>
					<th>Ports</th>
				</tr>
			</thead>
			<tbody>
				{{range $ip, $node := .NodeStatuses }}
				<tr>
					<td>{{ $ip }}</td>
					<td>{{ $node.LastPingDuration }}</td>
					<td class="ports-column">
						<div class="port-container">
							{{range $port := $node.Ports }}
								{{if $port.Verified}}
								<div class="port-box" onclick="openModal({ ip: '{{ $ip }}', portNumber: {{ $port.PortNumber }}, notes: '{{ $port.Notes }}', verified: {{ $port.Verified }}})">
										{{ $port.PortNumber }}
									</div>
								{{else}}
								<div class="port-box port-box-warning" onclick="openModal({ ip: '{{ $ip }}', portNumber: {{ $port.PortNumber }}, notes: '{{ $port.Notes }}', verified: {{ $port.Verified }}})">
										{{ $port.PortNumber }}
									</div>
								{{end}}
							{{end}}
						</div>
					</td>
				</tr>
				{{end}}
			</tbody>
		</table>
	</div>

	<!-- Modal box for showing port details -->
	<div id="portModal" class="modal">
		<div class="modal-content">
			<span class="close" onclick="closeModal()">&times;</span>
			<h2 id="modal-title"></h2>
			<form id="port-form">
				<input type="hidden" id="port-ip" name="port-ip" />
				<div class="modal-checkbox-container">
					<label for="port-verified">Verified:</label>
					<input type="checkbox" id="port-verified" name="port-verified" />
				</div>

				<div class="modal-port-notes-container">
					<label for="port-notes">Notes:</label>
					<textarea id="port-notes" name="port-notes" rows="4" cols="50"></textarea>
				</div>

				<button type="submit" onclick="savePortDetails()">Save</button>
			</form>
		</div>
	</div>

	<script>
		let g_changesReceived = false;

		// Function to open modal with the port info
		function openModal(info) {
			document.getElementById('modal-title').textContent = `${info.ip}:${info.portNumber} details`;
			document.getElementById('port-verified').checked = info.verified;
			document.getElementById('port-notes').textContent = info.notes;
			document.getElementById('port-ip').value = info.ip;
			document.getElementById('portModal').style.display = 'block';
		}

		// Function to close modal
		function closeModal() {
			document.getElementById('portModal').style.display = 'none';

			if (g_changesReceived) {
				location.reload();
			}
		}

		function modalOpened() {
			return document.getElementById('portModal').style.display === 'block';
		}

		function savePortDetails() {
			const notes = document.getElementById('port-notes').value;
			const verified = document.getElementById('port-verified').checked;

			console.log('Notes:', notes);
			console.log('Verified:', verified);

			closeModal();
		}

		// Handle form submission
		document.getElementById('port-form').onsubmit = function(e) {
			e.preventDefault();
			const verified = document.getElementById('port-verified').checked;
			const notes = document.getElementById('port-notes').value;
			// You can add functionality to save the form data here
			closeModal();
		};

		// Websocket connection
		const socket = new WebSocket("ws://localhost:8080/ws");

		socket.onopen = function () {
			console.log('web sock connection opened')
		};

		socket.onmessage = function (e) {
			g_changesReceived = true;

			if (modalOpened()) {
				return;
			} else {
				g_changesReceived = false;
				location.reload();
			}
		};

		function send() {
			socket.send(input.value);
			input.value = "";
		}
	</script>

</body>
</html>
